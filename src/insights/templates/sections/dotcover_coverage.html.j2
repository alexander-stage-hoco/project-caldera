<section id="{{ section_id }}" class="report-section">
    <h2>.NET Code Coverage</h2>

    {% if not has_data %}
    <div class="empty-state">
        <p>No .NET coverage data available. Either dotCover was not run or no assemblies were analyzed.</p>
    </div>
    {% else %}

    <div class="metric-grid">
        <div class="metric-card">
            <div class="label">Overall Coverage</div>
            <div class="value">{{ summary.overall_coverage_pct | format_number }}%</div>
        </div>
        <div class="metric-card">
            <div class="label">Coverage Grade</div>
            <div class="value">
                <span class="risk-indicator risk-{% if coverage_grade == 'A' %}low{% elif coverage_grade == 'B' %}low{% elif coverage_grade == 'C' %}medium{% elif coverage_grade == 'D' %}high{% else %}critical{% endif %}">{{ coverage_grade }}</span>
            </div>
        </div>
        <div class="metric-card">
            <div class="label">Assemblies</div>
            <div class="value">{{ summary.assembly_count | format_number }}</div>
        </div>
        <div class="metric-card">
            <div class="label">Total Statements</div>
            <div class="value">{{ summary.total_statements | format_number }}</div>
        </div>
    </div>

    {% if summary.overall_coverage_pct is not none and summary.overall_coverage_pct < 60 %}
    <div class="alert alert-high">
        <strong>Low overall coverage ({{ summary.overall_coverage_pct }}%).</strong> Consider prioritizing coverage improvements for critical business logic.
    </div>
    {% endif %}

    {% if assemblies %}
    <div class="subsection">
        <h3>Assembly Coverage (Lowest First)</h3>
        <table>
            <thead>
                <tr>
                    <th>Assembly</th>
                    <th class="number">Covered</th>
                    <th class="number">Total</th>
                    <th class="number">Coverage %</th>
                </tr>
            </thead>
            <tbody>
            {% for a in assemblies %}
                <tr>
                    <td><code>{{ a.assembly_name }}</code></td>
                    <td class="number">{{ a.covered_statements | format_number }}</td>
                    <td class="number">{{ a.total_statements | format_number }}</td>
                    <td class="number">{{ a.statement_coverage_pct | format_number }}%</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {% if low_coverage_files %}
    <div class="subsection">
        <h3>Low-Coverage File Hotspots</h3>
        <table>
            <thead>
                <tr>
                    <th>File</th>
                    <th class="number">Types</th>
                    <th class="number">Coverage %</th>
                    <th class="number">Gap to 80%</th>
                    <th>Risk</th>
                </tr>
            </thead>
            <tbody>
            {% for f in low_coverage_files %}
                <tr>
                    <td class="truncate" title="{{ f.relative_path }}">{{ f.relative_path | truncate_path }}</td>
                    <td class="number">{{ f.type_count | format_number }}</td>
                    <td class="number">{{ f.statement_coverage_pct | format_number }}%</td>
                    <td class="number">{{ f.gap_to_target_pct | format_number }}%</td>
                    <td><span class="risk-indicator risk-{{ f.risk_level }}">{{ f.risk_level | upper }}</span></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {% if namespaces %}
    <div class="subsection">
        <h3>Namespace Coverage (Lowest First)</h3>
        <table>
            <thead>
                <tr>
                    <th>Namespace</th>
                    <th class="number">Types</th>
                    <th class="number">Covered</th>
                    <th class="number">Total</th>
                    <th class="number">Coverage %</th>
                </tr>
            </thead>
            <tbody>
            {% for ns in namespaces %}
                <tr>
                    <td><code>{{ ns.namespace or '(root)' }}</code></td>
                    <td class="number">{{ ns.type_count | format_number }}</td>
                    <td class="number">{{ ns.covered_statements | format_number }}</td>
                    <td class="number">{{ ns.total_statements | format_number }}</td>
                    <td class="number">{{ ns.coverage_pct | format_number }}%</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {% endif %}
</section>
