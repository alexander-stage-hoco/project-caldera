# Common compliance rules shared across all tools

required_paths:
  - Makefile
  - README.md
  - BLUEPRINT.md
  - EVAL_STRATEGY.md
  - requirements.txt
  - scripts/analyze.py
  - scripts/evaluate.py
  - scripts/checks
  - schemas/output.schema.json
  - eval-repos/synthetic
  - eval-repos/real
  - evaluation/ground-truth
  - evaluation/llm/orchestrator.py
  - evaluation/llm/judges
  - evaluation/llm/prompts
  - evaluation/scorecard.md
  - tests/unit
  - tests/integration

required_make_targets:
  - setup
  - analyze
  - evaluate
  - evaluate-llm
  - test
  - clean

blueprint_required_sections:
  - Executive Summary
  - Architecture
  - Implementation Plan
  - Configuration
  - Performance
  - Evaluation
  - Risk

eval_strategy_required_sections:
  - Philosophy
  - Dimension Summary
  - Check Catalog
  - Scoring
  - Decision Thresholds
  - Ground Truth

# Entity-to-repository mapping for entity.repository_alignment check
tool_entities:
  scc:
    - SccFileMetric
  lizard:
    - LizardFileMetric
    - LizardFunctionMetric
  semgrep:
    - SemgrepSmell
  roslyn-analyzers:
    - RoslynViolation
  layout-scanner:
    - LayoutFile
    - LayoutDirectory
  trivy:
    - TrivyVulnerability
    - TrivyTarget
    - TrivyIacMisconfig
  sonarqube:
    - SonarqubeIssue
    - SonarqubeMetric
  git-sizer:
    - GitSizerMetric
    - GitSizerViolation
    - GitSizerLfsCandidate
  gitleaks:
    - GitleaksSecret
  symbol-scanner:
    - CodeSymbol
    - SymbolCall
    - FileImport
  scancode:
    - ScancodeFileLicense
    - ScancodeSummary
  pmd-cpd:
    - PmdCpdFileMetric
    - PmdCpdDuplication
    - PmdCpdOccurrence
  devskim:
    - DevskimFinding
  dotcover:
    - DotcoverAssemblyCoverage
    - DotcoverTypeCoverage
    - DotcoverMethodCoverage

entity_repository_map:
  SccFileMetric:
    repository: SccRepository
    method: insert_file_metrics
  LizardFileMetric:
    repository: LizardRepository
    method: insert_file_metrics
  LizardFunctionMetric:
    repository: LizardRepository
    method: insert_function_metrics
  SemgrepSmell:
    repository: SemgrepRepository
    method: insert_smells
  RoslynViolation:
    repository: RoslynRepository
    method: insert_violations
  LayoutFile:
    repository: LayoutRepository
    method: insert_files
  LayoutDirectory:
    repository: LayoutRepository
    method: insert_directories
  TrivyVulnerability:
    repository: TrivyRepository
    method: insert_vulnerabilities
  TrivyTarget:
    repository: TrivyRepository
    method: insert_targets
  TrivyIacMisconfig:
    repository: TrivyRepository
    method: insert_iac_misconfigs
  SonarqubeIssue:
    repository: SonarqubeRepository
    method: insert_issues
  SonarqubeMetric:
    repository: SonarqubeRepository
    method: insert_metrics
  GitSizerMetric:
    repository: GitSizerRepository
    method: insert_metrics
  GitSizerViolation:
    repository: GitSizerRepository
    method: insert_violations
  GitSizerLfsCandidate:
    repository: GitSizerRepository
    method: insert_lfs_candidates
  GitleaksSecret:
    repository: GitleaksRepository
    method: insert_secrets
  CodeSymbol:
    repository: SymbolScannerRepository
    method: insert_symbols
  SymbolCall:
    repository: SymbolScannerRepository
    method: insert_calls
  FileImport:
    repository: SymbolScannerRepository
    method: insert_imports
  ScancodeFileLicense:
    repository: ScancodeRepository
    method: insert_file_licenses
  ScancodeSummary:
    repository: ScancodeRepository
    method: insert_summary
  PmdCpdFileMetric:
    repository: PmdCpdRepository
    method: insert_file_metrics
  PmdCpdDuplication:
    repository: PmdCpdRepository
    method: insert_duplications
  PmdCpdOccurrence:
    repository: PmdCpdRepository
    method: insert_occurrences
  DevskimFinding:
    repository: DevskimRepository
    method: insert_findings
  DotcoverAssemblyCoverage:
    repository: DotcoverRepository
    method: insert_assembly_coverage
  DotcoverTypeCoverage:
    repository: DotcoverRepository
    method: insert_type_coverage
  DotcoverMethodCoverage:
    repository: DotcoverRepository
    method: insert_method_coverage

# Patterns for quality rule detection
quality_rule_patterns:
  paths:
    - is_repo_relative
    - normalize_file_path
    - path invalid
    - normalize_dir_path
  ranges:
    - check_non_negative
    - ">= 0"
    - "<= "
    - must be
  ratios:
    - check_ratio
    - ratio
    - / 0
    - division
  required_fields:
    - check_required
    - is None
    - required
  line_numbers:
    - line_start
    - line_end
    - ">= 1"

# Data completeness validation rules
data_completeness_rules:
  # Count field to list field mappings for consistency checks
  count_list_pairs:
    - count_field: file_count
      list_field: files
    - count_field: finding_count
      list_field: findings
    - count_field: vulnerability_count
      list_field: vulnerabilities
    - count_field: secret_count
      list_field: secrets
    - count_field: issue_count
      list_field: issues
    - count_field: violation_count
      list_field: violations
    - count_field: smell_count
      list_field: smells
    - count_field: function_count
      list_field: functions
    - count_field: symbol_count
      list_field: symbols
    - count_field: total_files
      list_field: files
    - count_field: total_findings
      list_field: findings
  # Required fields per data type (non-null validation)
  required_data_fields:
    files:
      - path
    findings:
      - file_path
      - message
    vulnerabilities:
      - vulnerability_id
      - severity
    secrets:
      - file_path
      - rule_id
    issues:
      - key
      - severity
    violations:
      - file_path
      - rule_id
    smells:
      - file_path
      - rule_id
    functions:
      - name
      - file_path
    # Generic symbols (most tools)
    symbols:
      - name
      - file_path
  # Tool-specific overrides for required_data_fields
  required_data_fields_overrides:
    symbol-scanner:
      symbols:
        - symbol_name
        - path
    trivy:
      vulnerabilities:
        - id        # trivy uses 'id' not 'vulnerability_id'
        - severity
    scancode:
      findings:
        - file_path
        - spdx_id   # scancode uses spdx_id not message

# Path consistency validation rules
path_consistency_rules:
  # Cross-reference path sections (source field should match target field)
  cross_reference_sections:
    - source: findings[].file_path
      target: files[].path
    - source: vulnerabilities[].file_path
      target: files[].path
    - source: secrets[].file_path
      target: files[].path
    - source: issues[].file_path
      target: files[].path
    - source: violations[].file_path
      target: files[].path
    - source: smells[].file_path
      target: files[].path
    - source: functions[].file_path
      target: files[].path
    - source: symbols[].file_path
      target: files[].path
  # Fields that must be repo-relative
  repo_relative_fields:
    - data.files[].path
    - data.findings[].file_path
    - data.vulnerabilities[].file_path
    - data.secrets[].file_path
    - data.issues[].file_path
    - data.violations[].file_path
    - data.smells[].file_path
    - data.functions[].file_path
    - data.symbols[].file_path
    - data.directories[].path

# Test coverage validation rules
test_coverage_rules:
  threshold: 80
  source_dirs:
    - scripts
  omit_patterns:
    - "scripts/checks/*"
    - "scripts/evaluate.py"
    - "**/conftest.py"
