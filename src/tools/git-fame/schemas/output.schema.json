{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "git-fame.output.v1.0.0",
  "title": "Git-Fame Output Schema",
  "description": "Unified output schema for git-fame authorship analysis following Caldera envelope format",
  "type": "object",
  "required": ["metadata", "data"],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Standard Caldera metadata envelope",
      "required": [
        "tool_name",
        "tool_version",
        "run_id",
        "repo_id",
        "branch",
        "commit",
        "timestamp",
        "schema_version"
      ],
      "properties": {
        "tool_name": {
          "type": "string",
          "const": "git-fame",
          "description": "Tool identifier"
        },
        "tool_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Semver version of git-fame"
        },
        "run_id": {
          "type": "string",
          "format": "uuid",
          "description": "Collection run UUID"
        },
        "repo_id": {
          "type": "string",
          "format": "uuid",
          "description": "Repository UUID"
        },
        "branch": {
          "type": "string",
          "description": "Git branch name"
        },
        "commit": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]{40}$",
          "description": "Full 40-character git SHA"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of when the analysis was generated"
        },
        "schema_version": {
          "type": "string",
          "const": "1.0.0",
          "description": "Output schema version"
        }
      }
    },
    "data": {
      "type": "object",
      "description": "Tool-specific analysis results",
      "required": ["tool", "tool_version", "repo_name", "provenance", "summary", "authors"],
      "properties": {
        "tool": {
          "type": "string",
          "const": "git-fame",
          "description": "Tool identifier"
        },
        "tool_version": {
          "type": "string",
          "description": "Version of git-fame used for analysis"
        },
        "repo_name": {
          "type": "string",
          "description": "Name of the analyzed repository"
        },
        "error": {
          "type": "string",
          "description": "Error message if analysis failed"
        },
        "provenance": {
          "type": "object",
          "required": ["tool", "commands"],
          "properties": {
            "tool": {
              "type": "string",
              "description": "Name of the analysis tool"
            },
            "commands": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "minItems": 1,
              "description": "Commands used to run the analysis"
            }
          }
        },
        "summary": {
          "type": "object",
          "required": ["author_count", "total_loc", "hhi_index", "bus_factor", "top_author_pct"],
          "properties": {
            "author_count": {
              "type": "integer",
              "minimum": 0,
              "description": "Total number of authors with surviving LOC"
            },
            "total_loc": {
              "type": "integer",
              "minimum": 0,
              "description": "Total lines of code in the repository"
            },
            "hhi_index": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Herfindahl-Hirschman Index for ownership concentration (0=equal, 1=monopoly)"
            },
            "bus_factor": {
              "type": "integer",
              "minimum": 0,
              "description": "Minimum authors needed for 50% code coverage"
            },
            "top_author_pct": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Percentage of code owned by the top author"
            },
            "top_two_pct": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Combined percentage of code owned by top two authors"
            }
          }
        },
        "authors": {
          "type": "array",
          "description": "Per-author metrics sorted by ownership percentage descending",
          "items": {
            "type": "object",
            "required": ["name", "surviving_loc", "commit_count", "ownership_pct"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Author name"
              },
              "surviving_loc": {
                "type": "integer",
                "minimum": 0,
                "description": "Lines of code currently attributed to this author"
              },
              "insertions_total": {
                "type": "integer",
                "minimum": 0,
                "description": "Total lines inserted by this author"
              },
              "deletions_total": {
                "type": "integer",
                "minimum": 0,
                "description": "Total lines deleted by this author"
              },
              "commit_count": {
                "type": "number",
                "minimum": 0,
                "description": "Number of commits by this author (may be fractional for normalized values)"
              },
              "files_touched": {
                "type": "number",
                "minimum": 0,
                "description": "Number of files modified by this author (may be fractional for normalized values)"
              },
              "ownership_pct": {
                "type": "number",
                "minimum": 0,
                "maximum": 100,
                "description": "Percentage of total LOC owned by this author"
              }
            }
          }
        }
      }
    }
  }
}
