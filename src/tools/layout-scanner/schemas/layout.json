{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://vulcan.example.com/schemas/layout-scanner/1.0/layout.json",
  "title": "Layout Scanner Output",
  "description": "Output schema for the Layout Scanner tool",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "tool",
    "tool_version",
    "run_id",
    "timestamp",
    "repository",
    "repository_path",
    "passes_completed",
    "statistics",
    "files",
    "directories",
    "hierarchy"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Schema version"
    },
    "tool": {
      "type": "string",
      "const": "layout-scanner",
      "description": "Tool name"
    },
    "tool_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Tool version (semver)"
    },
    "run_id": {
      "type": "string",
      "pattern": "^layout-\\d{8}-\\d{6}-.+$",
      "description": "Unique run identifier"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of scan"
    },
    "repository": {
      "type": "string",
      "description": "Repository name"
    },
    "repository_path": {
      "type": "string",
      "description": "Absolute path to repository"
    },
    "passes_completed": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["filesystem", "git", "content"]
      },
      "description": "List of completed analysis passes"
    },
    "statistics": {
      "$ref": "#/$defs/statistics"
    },
    "files": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/fileObject"
      },
      "description": "Map of relative path to file object"
    },
    "directories": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/directoryObject"
      },
      "description": "Map of relative path to directory object"
    },
    "hierarchy": {
      "$ref": "#/$defs/hierarchy"
    }
  },
  "$defs": {
    "statistics": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "total_files",
        "total_directories",
        "total_size_bytes",
        "max_depth",
        "scan_duration_ms",
        "files_per_second",
        "by_classification",
        "by_language"
      ],
      "properties": {
        "total_files": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of files"
        },
        "total_directories": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of directories"
        },
        "total_size_bytes": {
          "type": "integer",
          "minimum": 0,
          "description": "Total size in bytes"
        },
        "max_depth": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum directory depth"
        },
        "scan_duration_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Scan duration in milliseconds"
        },
        "files_per_second": {
          "type": "number",
          "minimum": 0,
          "description": "Files scanned per second"
        },
        "by_classification": {
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          },
          "description": "File count by classification"
        },
        "by_language": {
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          },
          "description": "File count by language"
        },
        "directory_depth_stats": {
          "$ref": "#/$defs/distributionStats"
        },
        "files_per_directory_stats": {
          "$ref": "#/$defs/distributionStats"
        },
        "size_per_file_stats": {
          "$ref": "#/$defs/distributionStats"
        }
      }
    },
    "distributionStats": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "count": { "type": "integer", "minimum": 0 },
        "min": { "type": ["number", "null"] },
        "max": { "type": ["number", "null"] },
        "mean": { "type": ["number", "null"] },
        "std_dev": { "type": ["number", "null"] },
        "p25": { "type": ["number", "null"] },
        "p50": { "type": ["number", "null"] },
        "p75": { "type": ["number", "null"] },
        "skewness": { "type": ["number", "null"] },
        "kurtosis": { "type": ["number", "null"] }
      }
    },
    "fileObject": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "path",
        "name",
        "extension",
        "size_bytes",
        "modified_time",
        "is_symlink",
        "language",
        "classification",
        "classification_reason",
        "classification_confidence",
        "parent_directory_id",
        "depth"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^f-[a-f0-9]{12}$",
          "description": "Unique file ID"
        },
        "path": {
          "type": "string",
          "description": "Relative path from repository root"
        },
        "name": {
          "type": "string",
          "description": "Filename"
        },
        "extension": {
          "type": "string",
          "description": "File extension including dot"
        },
        "size_bytes": {
          "type": "integer",
          "minimum": 0,
          "description": "File size in bytes"
        },
        "modified_time": {
          "type": "string",
          "format": "date-time",
          "description": "Last modification time"
        },
        "is_symlink": {
          "type": "boolean",
          "description": "Whether file is a symlink"
        },
        "language": {
          "type": "string",
          "description": "Detected programming language"
        },
        "classification": {
          "type": "string",
          "pattern": "^(source|test|config|generated|docs|vendor|build|ci|other)(::[a-z]+)?$",
          "description": "File classification with optional subcategory (e.g., test::unit, config::build)"
        },
        "classification_reason": {
          "type": "string",
          "description": "Explanation for classification"
        },
        "classification_confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Classification confidence score"
        },
        "parent_directory_id": {
          "type": "string",
          "pattern": "^d-[a-f0-9]{12}$",
          "description": "Parent directory ID"
        },
        "depth": {
          "type": "integer",
          "minimum": 0,
          "description": "Depth in directory tree"
        },
        "first_commit_date": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Date of first commit (git pass)"
        },
        "last_commit_date": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Date of last commit (git pass)"
        },
        "commit_count": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Number of commits (git pass)"
        },
        "author_count": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Number of authors (git pass)"
        },
        "content_hash": {
          "type": ["string", "null"],
          "description": "Content hash (content pass)"
        },
        "is_binary": {
          "type": ["boolean", "null"],
          "description": "Whether file is binary (content pass)"
        },
        "line_count": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Line count (content pass)"
        }
      }
    },
    "directoryObject": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "path",
        "name",
        "modified_time",
        "is_symlink",
        "classification",
        "classification_reason",
        "depth",
        "child_directory_ids",
        "child_file_ids",
        "direct_file_count",
        "direct_directory_count",
        "recursive_file_count",
        "recursive_directory_count",
        "direct_size_bytes",
        "recursive_size_bytes",
        "classification_distribution",
        "language_distribution"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^d-[a-f0-9]{12}$",
          "description": "Unique directory ID"
        },
        "path": {
          "type": "string",
          "description": "Relative path from repository root"
        },
        "name": {
          "type": "string",
          "description": "Directory name"
        },
        "modified_time": {
          "type": "string",
          "format": "date-time",
          "description": "Last modification time"
        },
        "is_symlink": {
          "type": "boolean",
          "description": "Whether directory is a symlink"
        },
        "classification": {
          "type": "string",
          "pattern": "^(source|test|config|generated|docs|vendor|build|ci|other)(::[a-z]+)?$",
          "description": "Directory classification with optional subcategory (e.g., test::unit, config::build)"
        },
        "classification_reason": {
          "type": "string",
          "description": "Explanation for classification"
        },
        "parent_directory_id": {
          "type": ["string", "null"],
          "description": "Parent directory ID (null for root)"
        },
        "depth": {
          "type": "integer",
          "minimum": 0,
          "description": "Depth in directory tree"
        },
        "child_directory_ids": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^d-[a-f0-9]{12}$"
          },
          "description": "IDs of immediate child directories"
        },
        "child_file_ids": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^f-[a-f0-9]{12}$"
          },
          "description": "IDs of immediate child files"
        },
        "direct_file_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of files directly in this directory"
        },
        "direct_directory_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of subdirectories directly in this directory"
        },
        "recursive_file_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total files in subtree"
        },
        "recursive_directory_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total directories in subtree"
        },
        "direct_size_bytes": {
          "type": "integer",
          "minimum": 0,
          "description": "Size of files directly in this directory"
        },
        "recursive_size_bytes": {
          "type": "integer",
          "minimum": 0,
          "description": "Total size of subtree"
        },
        "classification_distribution": {
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          },
          "description": "File count by classification in subtree"
        },
        "language_distribution": {
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          },
          "description": "File count by language in subtree"
        }
      }
    },
    "hierarchy": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "root_id",
        "max_depth",
        "total_files",
        "total_directories",
        "total_size_bytes",
        "children",
        "parents",
        "depth_distribution"
      ],
      "properties": {
        "root_id": {
          "type": "string",
          "pattern": "^d-[a-f0-9]{12}$",
          "description": "Root directory ID"
        },
        "max_depth": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum depth"
        },
        "total_files": {
          "type": "integer",
          "minimum": 0,
          "description": "Total files"
        },
        "total_directories": {
          "type": "integer",
          "minimum": 0,
          "description": "Total directories"
        },
        "total_size_bytes": {
          "type": "integer",
          "minimum": 0,
          "description": "Total size"
        },
        "children": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "description": "Map of parent ID to child IDs"
        },
        "parents": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Map of child ID to parent ID"
        },
        "depth_distribution": {
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          },
          "description": "Count of items at each depth level"
        }
      }
    }
  }
}
