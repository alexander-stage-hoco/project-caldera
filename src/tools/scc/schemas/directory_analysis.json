{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Directory Analysis Output",
  "description": "Schema for directory-level analysis with distribution statistics and hotspot detection",
  "type": "object",
  "required": ["schema_version", "run_id", "root_path", "directories", "summary"],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0",
      "description": "Schema version"
    },
    "run_id": {
      "type": "string",
      "description": "Unique identifier for this analysis run"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of analysis"
    },
    "root_path": {
      "type": "string",
      "description": "Root path of analyzed directory"
    },
    "cocomo_params": {
      "type": "object",
      "description": "COCOMO parameters used for cost estimation",
      "properties": {
        "preset": {"type": "string", "description": "Preset name used"},
        "a": {"type": "number", "description": "Effort multiplier"},
        "b": {"type": "number", "description": "Effort exponent"},
        "c": {"type": "number", "description": "Schedule multiplier"},
        "d": {"type": "number", "description": "Schedule exponent"},
        "avg_wage": {"type": "number", "description": "Average annual salary"},
        "overhead": {"type": "number", "description": "Overhead factor"},
        "eaf": {"type": "number", "description": "Effort adjustment factor"}
      }
    },
    "directories": {
      "type": "array",
      "description": "List of all directories with their statistics",
      "items": {"$ref": "#/definitions/DirectoryEntry"}
    },
    "summary": {"$ref": "#/definitions/SummaryStats"}
  },
  "definitions": {
    "DirectoryEntry": {
      "type": "object",
      "description": "Statistics for a single directory",
      "required": ["path", "depth", "direct", "recursive", "hotspot_score"],
      "properties": {
        "path": {
          "type": "string",
          "description": "Full path to directory"
        },
        "name": {
          "type": "string",
          "description": "Directory name (last component of path)"
        },
        "depth": {
          "type": "integer",
          "minimum": 0,
          "description": "Nesting depth from root"
        },
        "direct": {
          "$ref": "#/definitions/DirectoryStats",
          "description": "Stats for files directly in this directory (not subdirectories)"
        },
        "recursive": {
          "$ref": "#/definitions/DirectoryStats",
          "description": "Stats for all files in this directory and subdirectories"
        },
        "files": {
          "type": "array",
          "description": "Files directly in this directory",
          "items": {"$ref": "#/definitions/FileEntry"}
        },
        "subdirectories": {
          "type": "array",
          "description": "Immediate child directories",
          "items": {"type": "string"}
        },
        "hotspot_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Hotspot score (0-1, higher = more concerning)"
        },
        "hotspot_rank": {
          "type": "integer",
          "minimum": 1,
          "description": "Rank among all directories by hotspot score (1 = highest)"
        },
        "is_hotspot": {
          "type": "boolean",
          "description": "True if hotspot_score > 0.7"
        }
      }
    },
    "DirectoryStats": {
      "type": "object",
      "description": "Aggregate statistics for a set of files",
      "properties": {
        "file_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of files"
        },
        "lines_total": {
          "type": "integer",
          "minimum": 0,
          "description": "Total lines (code + comment + blank)"
        },
        "lines_code": {
          "type": "integer",
          "minimum": 0,
          "description": "Lines of code"
        },
        "lines_comment": {
          "type": "integer",
          "minimum": 0,
          "description": "Comment lines"
        },
        "lines_blank": {
          "type": "integer",
          "minimum": 0,
          "description": "Blank lines"
        },
        "bytes": {
          "type": "integer",
          "minimum": 0,
          "description": "Total bytes"
        },
        "complexity_total": {
          "type": "integer",
          "minimum": 0,
          "description": "Sum of cyclomatic complexity"
        },
        "uloc": {
          "type": "integer",
          "minimum": 0,
          "description": "Unique lines of code (non-duplicated)"
        },
        "languages": {
          "type": "object",
          "description": "File count by language",
          "additionalProperties": {"type": "integer"}
        },
        "minified_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of minified files"
        },
        "generated_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of generated files"
        },
        "distribution": {
          "$ref": "#/definitions/DistributionStats",
          "description": "Distribution statistics for key metrics"
        }
      }
    },
    "DistributionStats": {
      "type": "object",
      "description": "Distribution statistics for directory metrics",
      "properties": {
        "loc": {
          "$ref": "#/definitions/MetricDistribution",
          "description": "Lines of code distribution"
        },
        "complexity": {
          "$ref": "#/definitions/MetricDistribution",
          "description": "Complexity distribution"
        },
        "comment_ratio": {
          "$ref": "#/definitions/MetricDistribution",
          "description": "Comment ratio distribution"
        },
        "uloc_ratio": {
          "$ref": "#/definitions/MetricDistribution",
          "description": "ULOC ratio (uniqueness) distribution"
        }
      }
    },
    "MetricDistribution": {
      "type": "object",
      "description": "Statistical distribution for a single metric",
      "properties": {
        "min": {"type": "number", "description": "Minimum value"},
        "max": {"type": "number", "description": "Maximum value"},
        "mean": {"type": "number", "description": "Arithmetic mean"},
        "median": {"type": "number", "description": "Median (50th percentile)"},
        "stddev": {"type": "number", "description": "Standard deviation"},
        "p25": {"type": "number", "description": "25th percentile"},
        "p75": {"type": "number", "description": "75th percentile"},
        "p90": {"type": "number", "description": "90th percentile"},
        "p95": {"type": "number", "description": "95th percentile"},
        "skewness": {
          "type": "number",
          "description": "Skewness (>0 = right-tailed, <0 = left-tailed)"
        },
        "kurtosis": {
          "type": "number",
          "description": "Excess kurtosis (>0 = heavy-tailed, <0 = light-tailed)"
        }
      }
    },
    "FileEntry": {
      "type": "object",
      "description": "Individual file statistics",
      "properties": {
        "path": {"type": "string", "description": "Full file path"},
        "filename": {"type": "string", "description": "File name only"},
        "language": {"type": "string", "description": "Detected language"},
        "lines": {"type": "integer", "minimum": 0, "description": "Total lines"},
        "code": {"type": "integer", "minimum": 0, "description": "Code lines"},
        "comment": {"type": "integer", "minimum": 0, "description": "Comment lines"},
        "blank": {"type": "integer", "minimum": 0, "description": "Blank lines"},
        "bytes": {"type": "integer", "minimum": 0, "description": "File size"},
        "complexity": {"type": "integer", "minimum": 0, "description": "Cyclomatic complexity"},
        "uloc": {"type": "integer", "minimum": 0, "description": "Unique lines"},
        "comment_ratio": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Ratio of comments to total lines"
        },
        "complexity_density": {
          "type": "number",
          "minimum": 0,
          "description": "Complexity per line of code"
        },
        "is_minified": {"type": "boolean", "description": "Detected as minified"},
        "is_generated": {"type": "boolean", "description": "Detected as generated"},
        "is_outlier": {"type": "boolean", "description": "Statistical outlier in its directory"},
        "outlier_reasons": {
          "type": "array",
          "description": "Reasons for outlier classification",
          "items": {"type": "string"}
        }
      }
    },
    "SummaryStats": {
      "type": "object",
      "description": "Overall summary statistics",
      "properties": {
        "total_directories": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of directories"
        },
        "total_files": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of files"
        },
        "total_loc": {
          "type": "integer",
          "minimum": 0,
          "description": "Total lines of code"
        },
        "total_complexity": {
          "type": "integer",
          "minimum": 0,
          "description": "Total cyclomatic complexity"
        },
        "hotspot_directories": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of directories flagged as hotspots"
        },
        "dryness_pct": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "DRYness percentage (ULOC/LOC)"
        },
        "cocomo": {
          "type": "object",
          "description": "COCOMO cost estimates",
          "properties": {
            "effort_person_months": {"type": "number", "minimum": 0},
            "schedule_months": {"type": "number", "minimum": 0},
            "people": {"type": "number", "minimum": 0},
            "cost": {"type": "number", "minimum": 0}
          }
        }
      }
    }
  }
}
