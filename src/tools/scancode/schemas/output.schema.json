{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "scancode.output.v1.0.0",
  "title": "Scancode License Analyzer Output Schema",
  "description": "Caldera envelope format for license analysis output",
  "type": "object",
  "required": ["metadata", "data"],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Caldera envelope metadata",
      "required": [
        "tool_name",
        "tool_version",
        "run_id",
        "repo_id",
        "branch",
        "commit",
        "timestamp",
        "schema_version"
      ],
      "properties": {
        "tool_name": {
          "type": "string",
          "const": "scancode",
          "description": "Tool identifier"
        },
        "tool_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Tool version in semver format"
        },
        "run_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique run identifier (UUID)"
        },
        "repo_id": {
          "type": "string",
          "format": "uuid",
          "description": "Repository identifier (UUID)"
        },
        "repo_name": {
          "type": "string",
          "description": "Repository name"
        },
        "repo_path": {
          "type": "string",
          "description": "Path to repository"
        },
        "branch": {
          "type": "string",
          "description": "Branch name being analyzed"
        },
        "commit": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]{40}$",
          "description": "Full 40-character commit SHA"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of analysis"
        },
        "schema_version": {
          "type": "string",
          "const": "1.0.0",
          "description": "Schema version"
        }
      }
    },
    "data": {
      "type": "object",
      "description": "Tool-specific analysis results",
      "required": ["tool", "tool_version", "scan_time_ms", "overall_risk"],
      "properties": {
        "tool": {
          "type": "string",
          "const": "scancode",
          "description": "Tool identifier"
        },
        "tool_version": {
          "type": "string",
          "description": "Version of license-analyzer"
        },
        "scan_time_ms": {
          "type": "number",
          "description": "Time taken to complete the analysis in milliseconds"
        },
        "total_files_scanned": {
          "type": "integer",
          "description": "Total number of files scanned"
        },
        "files_with_licenses": {
          "type": "integer",
          "description": "Number of files with license information"
        },
        "license_files_found": {
          "type": "integer",
          "description": "Number of LICENSE/COPYING files found"
        },
        "licenses_found": {
          "type": "array",
          "description": "List of unique SPDX license identifiers found",
          "items": {
            "type": "string"
          }
        },
        "license_counts": {
          "type": "object",
          "description": "Count of occurrences per license type",
          "additionalProperties": {
            "type": "integer"
          }
        },
        "has_permissive": {
          "type": "boolean",
          "description": "Whether permissive licenses were found (MIT, Apache, BSD, etc.)"
        },
        "has_weak_copyleft": {
          "type": "boolean",
          "description": "Whether weak copyleft licenses were found (LGPL, MPL)"
        },
        "has_copyleft": {
          "type": "boolean",
          "description": "Whether copyleft licenses were found (GPL, AGPL)"
        },
        "has_unknown": {
          "type": "boolean",
          "description": "Whether unknown/undetected licenses were present"
        },
        "overall_risk": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical", "unknown"],
          "description": "Overall license risk assessment"
        },
        "risk_reasons": {
          "type": "array",
          "description": "Reasons for the risk assessment",
          "items": {
            "type": "string"
          }
        },
        "findings": {
          "type": "array",
          "description": "Detailed license findings",
          "items": {
            "type": "object",
            "required": ["file_path", "spdx_id", "category", "confidence", "match_type"],
            "properties": {
              "file_path": {
                "type": "string",
                "description": "Repo-relative path to the file containing the license"
              },
              "spdx_id": {
                "type": "string",
                "description": "SPDX license identifier"
              },
              "category": {
                "type": "string",
                "enum": ["permissive", "weak-copyleft", "copyleft", "unknown"],
                "description": "License category"
              },
              "confidence": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Confidence score (0-1)"
              },
              "match_type": {
                "type": "string",
                "enum": ["file", "header", "spdx"],
                "description": "How the license was detected"
              },
              "line_number": {
                "type": "integer",
                "description": "Line number where license was found"
              }
            }
          }
        },
        "files": {
          "type": "object",
          "description": "Per-file license summary",
          "additionalProperties": {
            "type": "object",
            "required": ["file_path", "licenses", "category"],
            "properties": {
              "file_path": {
                "type": "string"
              },
              "licenses": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "category": {
                "type": "string",
                "enum": ["permissive", "weak-copyleft", "copyleft", "unknown"]
              },
              "has_spdx_header": {
                "type": "boolean"
              }
            }
          }
        },
        "directories": {
          "type": "object",
          "description": "Directory-level license rollups",
          "required": ["directory_count", "directories"],
          "properties": {
            "directory_count": {
              "type": "integer",
              "description": "Number of directory rollups included"
            },
            "directories": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["path", "direct", "recursive"],
                "properties": {
                  "path": {
                    "type": "string"
                  },
                  "direct": {
                    "$ref": "#/$defs/directoryStats"
                  },
                  "recursive": {
                    "$ref": "#/$defs/directoryStats"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "$defs": {
    "directoryStats": {
      "type": "object",
      "properties": {
        "file_count": {
          "type": "integer"
        },
        "files_with_licenses": {
          "type": "integer"
        },
        "license_counts": {
          "type": "object",
          "additionalProperties": {
            "type": "integer"
          }
        },
        "category_counts": {
          "type": "object",
          "additionalProperties": {
            "type": "integer"
          }
        },
        "has_copyleft": {
          "type": "boolean"
        },
        "has_weak_copyleft": {
          "type": "boolean"
        },
        "has_permissive": {
          "type": "boolean"
        },
        "worst_risk": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical", "unknown"]
        }
      }
    }
  }
}
