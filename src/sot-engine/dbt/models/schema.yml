version: 2

sources:
  - name: lz
    schema: main
    tables:
      - name: lz_tool_runs
      - name: lz_collection_runs
      - name: lz_layout_files
      - name: lz_layout_directories
      - name: lz_scc_file_metrics
      - name: lz_lizard_file_metrics
      - name: lz_lizard_function_metrics
      - name: lz_semgrep_smells
      - name: lz_roslyn_violations
      - name: lz_sonarqube_issues
      - name: lz_sonarqube_metrics
      - name: lz_trivy_vulnerabilities
      - name: lz_trivy_targets
      - name: lz_trivy_iac_misconfigs
      - name: lz_git_sizer_metrics
      - name: lz_git_sizer_violations
      - name: lz_git_sizer_lfs_candidates
      - name: lz_gitleaks_secrets
      - name: lz_code_symbols
      - name: lz_symbol_calls
      - name: lz_file_imports
      - name: lz_scancode_file_licenses
      - name: lz_scancode_summary
      - name: lz_pmd_cpd_file_metrics
      - name: lz_pmd_cpd_duplications
      - name: lz_pmd_cpd_occurrences
      - name: lz_devskim_findings
      - name: lz_dotcover_assembly_coverage
      - name: lz_dotcover_type_coverage
      - name: lz_dotcover_method_coverage
      - name: lz_dependensee_projects
      - name: lz_dependensee_project_refs
      - name: lz_dependensee_package_refs
      - name: lz_git_fame_authors
      - name: lz_git_fame_summary

models:
  - name: stg_lz_tool_runs
    columns:
      - name: run_pk
        tests:
          - not_null
          - unique
      - name: collection_run_id
        tests:
          - not_null
      - name: repo_id
        tests:
          - not_null
      - name: run_id
        tests:
          - not_null
      - name: tool_name
        tests:
          - not_null
      - name: commit
        tests:
          - not_null

  - name: stg_lz_layout_files
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null

  - name: stg_lz_layout_directories
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null

  - name: stg_lz_scc_file_metrics
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null

  - name: stg_lz_lizard_file_metrics
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null

  - name: stg_lz_lizard_function_metrics
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: function_name
        tests:
          - not_null
      - name: line_start
        tests:
          - not_null

  - name: rollup_scc_directory_recursive_distributions
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - lines_total
                  - code_lines
                  - comment_lines
                  - blank_lines
                  - complexity
      - name: value_count
        tests:
          - not_null

  - name: rollup_scc_directory_direct_distributions
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - lines_total
                  - code_lines
                  - comment_lines
                  - blank_lines
                  - complexity
      - name: value_count
        tests:
          - not_null

  - name: rollup_scc_directory_counts_direct
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_lines
        tests:
          - not_null
      - name: total_code_lines
        tests:
          - not_null
      - name: total_complexity
        tests:
          - not_null

  - name: rollup_scc_directory_counts_recursive
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_lines
        tests:
          - not_null
      - name: total_code_lines
        tests:
          - not_null
      - name: total_complexity
        tests:
          - not_null

  - name: rollup_lizard_directory_recursive_distributions
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - nloc
                  - total_ccn
                  - avg_ccn
                  - max_ccn
      - name: value_count
        tests:
          - not_null

  - name: rollup_lizard_directory_direct_distributions
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - nloc
                  - total_ccn
                  - avg_ccn
                  - max_ccn
      - name: value_count
        tests:
          - not_null

  - name: rollup_lizard_directory_counts_direct
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_nloc
        tests:
          - not_null
      - name: total_function_count
        tests:
          - not_null
      - name: total_ccn
        tests:
          - not_null

  - name: rollup_lizard_directory_counts_recursive
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_nloc
        tests:
          - not_null
      - name: total_function_count
        tests:
          - not_null
      - name: total_ccn
        tests:
          - not_null

  - name: unified_file_metrics
    description: "Unified file-level metrics combining scc, lizard, and symbol-scanner"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: loc_total
        tests:
          - not_null
      - name: symbol_run_pk
        description: "Symbol-scanner tool run primary key (null if not available)"
      - name: symbol_count
        description: "Number of symbols defined in file"
      - name: function_count
        description: "Number of functions defined in file"
      - name: class_count
        description: "Number of classes defined in file"
      - name: call_count
        description: "Number of outgoing function calls"
      - name: import_count
        description: "Number of file imports"

  - name: unified_run_summary
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: collection_run_id
        tests:
          - not_null
      - name: repo_id
        tests:
          - not_null
      - name: run_id
        tests:
          - not_null
      - name: total_files
        tests:
          - not_null

  - name: stg_semgrep_file_metrics
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: smell_count
        tests:
          - not_null

  - name: rollup_semgrep_directory_counts_recursive
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_smell_count
        tests:
          - not_null

  - name: rollup_semgrep_directory_counts_direct
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_smell_count
        tests:
          - not_null

  - name: rollup_semgrep_directory_recursive_distributions
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - smell_count
                  - severity_high_plus
      - name: value_count
        tests:
          - not_null

  - name: rollup_semgrep_directory_direct_distributions
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - smell_count
                  - severity_high_plus
      - name: value_count
        tests:
          - not_null

  - name: stg_lz_roslyn_violations
    description: "Staged Roslyn analyzer violations - individual findings"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: rule_id
        tests:
          - not_null
      - name: severity
        tests:
          - not_null

  - name: stg_roslyn_file_metrics
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: violation_count
        tests:
          - not_null

  - name: rollup_roslyn_directory_counts_recursive
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_violation_count
        tests:
          - not_null

  - name: rollup_roslyn_directory_counts_direct
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_violation_count
        tests:
          - not_null

  - name: rollup_roslyn_directory_recursive_distributions
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
      - name: value_count
        tests:
          - not_null

  - name: rollup_roslyn_directory_direct_distributions
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
      - name: value_count
        tests:
          - not_null

  - name: stg_sonarqube_issues
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: issue_key
        tests:
          - not_null
      - name: rule_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null

  - name: stg_sonarqube_file_metrics
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: issue_count
        tests:
          - not_null

  - name: rollup_sonarqube_directory_counts_direct
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_issue_count
        tests:
          - not_null

  - name: rollup_sonarqube_directory_counts_recursive
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_issue_count
        tests:
          - not_null

  - name: stg_trivy_vulnerabilities
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: target_key
        tests:
          - not_null
      - name: vulnerability_id
        tests:
          - not_null
      - name: package_name
        tests:
          - not_null

  - name: stg_trivy_targets
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: target_key
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null

  - name: stg_trivy_iac_misconfigs
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: misconfig_id
        tests:
          - not_null

  - name: stg_trivy_target_metrics
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: target_key
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: vulnerability_count
        tests:
          - not_null

  - name: rollup_trivy_directory_counts_direct
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: total_vulnerability_count
        tests:
          - not_null
      - name: total_iac_misconfig_count
        tests:
          - not_null

  - name: rollup_trivy_directory_counts_recursive
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: total_vulnerability_count
        tests:
          - not_null
      - name: total_iac_misconfig_count
        tests:
          - not_null

  - name: stg_lz_git_sizer_metrics
    description: Repository-level health metrics from git-sizer
    columns:
      - name: run_pk
        tests:
          - not_null
          - unique
      - name: repo_id
        tests:
          - not_null
      - name: health_grade
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['A', 'A+', 'B', 'B+', 'C', 'C+', 'D', 'D+', 'F']

  - name: stg_lz_git_sizer_violations
    description: Threshold violations detected by git-sizer
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
      - name: level
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: [1, 2, 3, 4]

  - name: stg_lz_git_sizer_lfs_candidates
    description: Files recommended for Git LFS migration
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_path
        tests:
          - not_null

  - name: repo_health_summary
    description: Repository health combining git-sizer with file metrics
    columns:
      - name: run_pk
        tests:
          - not_null
          - unique
      - name: collection_run_id
        tests:
          - not_null
      - name: health_grade
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['A', 'A+', 'B', 'B+', 'C', 'C+', 'D', 'D+', 'F']

  - name: stg_lz_code_symbols
    description: "Staged code symbols from symbol-scanner"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: symbol_name
        tests:
          - not_null
      - name: symbol_type
        tests:
          - not_null

  - name: stg_lz_symbol_calls
    description: "Staged symbol call relationships from symbol-scanner"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: caller_file_id
        tests:
          - not_null
      - name: callee_symbol
        tests:
          - not_null

  - name: stg_lz_file_imports
    description: "Staged file imports from symbol-scanner"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: imported_path
        tests:
          - not_null

  - name: stg_symbols_file_metrics
    description: "File-level aggregation of code symbols for distribution calculations"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: symbol_count
        tests:
          - not_null

  - name: stg_symbol_calls_file_metrics
    description: "File-level aggregation of symbol calls for distribution calculations"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: call_count
        tests:
          - not_null

  - name: stg_file_imports_file_metrics
    description: "File-level aggregation of imports for distribution calculations"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: import_count
        tests:
          - not_null

  - name: rollup_symbols_directory_direct_distributions
    description: "Distribution statistics for symbol metrics (direct scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - symbol_count
                  - function_count
                  - class_count
                  - exported_count
                  - avg_parameters
      - name: value_count
        tests:
          - not_null

  - name: rollup_symbols_directory_recursive_distributions
    description: "Distribution statistics for symbol metrics (recursive scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - symbol_count
                  - function_count
                  - class_count
                  - exported_count
                  - avg_parameters
      - name: value_count
        tests:
          - not_null

  - name: rollup_symbol_calls_directory_direct_distributions
    description: "Distribution statistics for symbol call metrics (direct scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - call_count
                  - distinct_callees
                  - distinct_callee_files
                  - direct_call_count
      - name: value_count
        tests:
          - not_null

  - name: rollup_symbol_calls_directory_recursive_distributions
    description: "Distribution statistics for symbol call metrics (recursive scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - call_count
                  - distinct_callees
                  - distinct_callee_files
                  - direct_call_count
      - name: value_count
        tests:
          - not_null

  - name: rollup_file_imports_directory_direct_distributions
    description: "Distribution statistics for file import metrics (direct scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - import_count
                  - unique_imports
                  - static_import_count
      - name: value_count
        tests:
          - not_null

  - name: rollup_file_imports_directory_recursive_distributions
    description: "Distribution statistics for file import metrics (recursive scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - import_count
                  - unique_imports
                  - static_import_count
      - name: value_count
        tests:
          - not_null

  - name: rollup_symbols_directory_counts_direct
    description: "Symbol counts per directory (direct scope - files in directory only)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: symbol_count
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: function_count
        tests:
          - not_null
      - name: class_count
        tests:
          - not_null
      - name: method_count
        tests:
          - not_null
      - name: exported_count
        tests:
          - not_null

  - name: rollup_symbols_directory_counts_recursive
    description: "Symbol counts per directory (recursive scope - includes subtree)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: symbol_count
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: function_count
        tests:
          - not_null
      - name: class_count
        tests:
          - not_null
      - name: method_count
        tests:
          - not_null
      - name: exported_count
        tests:
          - not_null

  - name: rollup_symbol_calls_directory_counts_direct
    description: "Symbol call counts per directory (direct scope - files in directory only)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_call_count
        tests:
          - not_null
      - name: total_distinct_callees
        tests:
          - not_null
      - name: total_distinct_callee_files
        tests:
          - not_null
      - name: total_direct_call_count
        tests:
          - not_null
      - name: total_dynamic_call_count
        tests:
          - not_null
      - name: total_async_call_count
        tests:
          - not_null

  - name: rollup_symbol_calls_directory_counts_recursive
    description: "Symbol call counts per directory (recursive scope - includes subtree)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_call_count
        tests:
          - not_null
      - name: total_distinct_callees
        tests:
          - not_null
      - name: total_distinct_callee_files
        tests:
          - not_null
      - name: total_direct_call_count
        tests:
          - not_null
      - name: total_dynamic_call_count
        tests:
          - not_null
      - name: total_async_call_count
        tests:
          - not_null

  - name: rollup_file_imports_directory_counts_direct
    description: "File import counts per directory (direct scope - files in directory only)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_import_count
        tests:
          - not_null
      - name: total_unique_imports
        tests:
          - not_null
      - name: total_static_import_count
        tests:
          - not_null
      - name: total_dynamic_import_count
        tests:
          - not_null
      - name: total_side_effect_import_count
        tests:
          - not_null

  - name: rollup_file_imports_directory_counts_recursive
    description: "File import counts per directory (recursive scope - includes subtree)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_import_count
        tests:
          - not_null
      - name: total_unique_imports
        tests:
          - not_null
      - name: total_static_import_count
        tests:
          - not_null
      - name: total_dynamic_import_count
        tests:
          - not_null
      - name: total_side_effect_import_count
        tests:
          - not_null

  - name: rollup_coupling_directory_metrics_direct
    description: "Coupling metrics per directory (direct - fan-in/fan-out for files directly in directory only)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: outgoing_calls
        description: "Total count of outgoing calls from files in this directory (may include duplicates)"
        tests:
          - not_null
      - name: distinct_callees
        description: "Count of distinct callee symbols called by files in this directory"
        tests:
          - not_null
      - name: fan_out
        description: "Count of distinct callee files that files in this directory call"
        tests:
          - not_null
      - name: fan_in
        description: "Count of distinct external caller files from OTHER directories calling into this directory (excludes internal calls)"
        tests:
          - not_null
      - name: direct_calls
        description: "Count of direct (non-dynamic, non-async) calls"
        tests:
          - not_null
      - name: dynamic_calls
        description: "Count of dynamic/late-bound calls"
        tests:
          - not_null
      - name: async_calls
        description: "Count of asynchronous calls"
        tests:
          - not_null
      - name: instability
        description: "fan_out / (fan_in + fan_out) - 0 = stable (many incoming deps), 1 = unstable (many outgoing deps)"
        tests:
          - not_null

  - name: rollup_coupling_directory_metrics_recursive
    description: "Coupling metrics per directory (recursive - includes all files in subtree, external means outside the subtree)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: outgoing_calls
        description: "Total count of outgoing calls from files in this subtree (may include duplicates)"
        tests:
          - not_null
      - name: distinct_callees
        description: "Count of distinct callee symbols called by files in this subtree"
        tests:
          - not_null
      - name: fan_out
        description: "Count of distinct callee files that files in this subtree call"
        tests:
          - not_null
      - name: fan_in
        description: "Count of distinct external caller files from OUTSIDE this subtree calling into this subtree (excludes internal calls)"
        tests:
          - not_null
      - name: direct_calls
        description: "Count of direct (non-dynamic, non-async) calls in this subtree"
        tests:
          - not_null
      - name: dynamic_calls
        description: "Count of dynamic/late-bound calls in this subtree"
        tests:
          - not_null
      - name: async_calls
        description: "Count of asynchronous calls in this subtree"
        tests:
          - not_null
      - name: instability
        description: "fan_out / (fan_in + fan_out) - 0 = stable (many incoming deps), 1 = unstable (many outgoing deps)"
        tests:
          - not_null

  - name: stg_lz_scancode_file_licenses
    description: "Staged license findings from scancode analysis"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: spdx_id
        tests:
          - not_null
      - name: category
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - permissive
                  - weak-copyleft
                  - copyleft
                  - unknown
      - name: confidence
        tests:
          - not_null
      - name: match_type
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - file
                  - header
                  - spdx

  - name: stg_lz_scancode_summary
    description: "Repository-level license summary from scancode analysis"
    columns:
      - name: run_pk
        tests:
          - not_null
          - unique
      - name: total_files_scanned
        tests:
          - not_null
      - name: files_with_licenses
        tests:
          - not_null
      - name: overall_risk
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - low
                  - medium
                  - high
                  - critical
                  - unknown
      - name: has_permissive
        tests:
          - not_null
      - name: has_weak_copyleft
        tests:
          - not_null
      - name: has_copyleft
        tests:
          - not_null
      - name: has_unknown
        tests:
          - not_null

  - name: stg_lz_pmd_cpd_file_metrics
    description: "Staged PMD-CPD file metrics from duplication analysis"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: total_lines
        tests:
          - not_null
      - name: duplicate_lines
        tests:
          - not_null
      - name: duplicate_blocks
        tests:
          - not_null
      - name: duplication_percentage
        tests:
          - not_null

  - name: rollup_pmd_cpd_directory_counts_direct
    description: "PMD-CPD duplication counts per directory (direct scope - files in directory only)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_lines
        tests:
          - not_null
      - name: total_duplicate_lines
        tests:
          - not_null
      - name: total_duplicate_blocks
        tests:
          - not_null
      - name: avg_duplication_percentage
        tests:
          - not_null

  - name: rollup_pmd_cpd_directory_counts_recursive
    description: "PMD-CPD duplication counts per directory (recursive scope - includes subtree)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_lines
        tests:
          - not_null
      - name: total_duplicate_lines
        tests:
          - not_null
      - name: total_duplicate_blocks
        tests:
          - not_null
      - name: avg_duplication_percentage
        tests:
          - not_null

  - name: stg_lz_pmd_cpd_duplications
    description: "Staged PMD-CPD duplication clones"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: clone_id
        tests:
          - not_null
      - name: lines
        tests:
          - not_null
      - name: tokens
        tests:
          - not_null
      - name: occurrence_count
        tests:
          - not_null
      - name: is_cross_file
        tests:
          - not_null

  - name: stg_lz_pmd_cpd_occurrences
    description: "Staged PMD-CPD clone occurrences"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: clone_id
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: line_start
        tests:
          - not_null
      - name: line_end
        tests:
          - not_null

  - name: rollup_pmd_cpd_directory_direct_distributions
    description: "Distribution statistics for PMD-CPD metrics (direct scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - duplicate_lines
                  - duplicate_blocks
                  - duplication_percentage
      - name: value_count
        tests:
          - not_null

  - name: rollup_pmd_cpd_directory_recursive_distributions
    description: "Distribution statistics for PMD-CPD metrics (recursive scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - duplicate_lines
                  - duplicate_blocks
                  - duplication_percentage
      - name: value_count
        tests:
          - not_null

  - name: stg_lz_devskim_findings
    description: "Staged DevSkim security findings"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: rule_id
        tests:
          - not_null

  - name: stg_devskim_file_metrics
    description: "File-level aggregation of DevSkim security findings"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: issue_count
        tests:
          - not_null

  - name: rollup_devskim_directory_counts_direct
    description: "DevSkim issue counts per directory (direct scope - files in directory only)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_issue_count
        tests:
          - not_null

  - name: rollup_devskim_directory_counts_recursive
    description: "DevSkim issue counts per directory (recursive scope - includes subtree)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_issue_count
        tests:
          - not_null

  - name: stg_lz_dotcover_assembly_coverage
    description: "Assembly-level code coverage from dotCover analysis"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: assembly_name
        tests:
          - not_null
      - name: covered_statements
        tests:
          - not_null
      - name: total_statements
        tests:
          - not_null
      - name: statement_coverage_pct
        tests:
          - not_null

  - name: stg_lz_dotcover_type_coverage
    description: "Type (class) level code coverage from dotCover analysis"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: assembly_name
        tests:
          - not_null
      - name: type_name
        tests:
          - not_null
      - name: covered_statements
        tests:
          - not_null
      - name: total_statements
        tests:
          - not_null
      - name: statement_coverage_pct
        tests:
          - not_null

  - name: stg_lz_dotcover_method_coverage
    description: "Method-level code coverage from dotCover analysis"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: assembly_name
        tests:
          - not_null
      - name: type_name
        tests:
          - not_null
      - name: method_name
        tests:
          - not_null
      - name: covered_statements
        tests:
          - not_null
      - name: total_statements
        tests:
          - not_null
      - name: statement_coverage_pct
        tests:
          - not_null

  - name: stg_scancode_file_metrics
    description: "File-level aggregation of license findings from scancode analysis"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: license_count
        tests:
          - not_null

  - name: stg_dotcover_file_metrics
    description: "File-level aggregation of type coverage from dotCover analysis"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: file_id
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: relative_path
        tests:
          - not_null
      - name: type_count
        tests:
          - not_null
      - name: statement_coverage_pct
        tests:
          - not_null

  - name: rollup_scancode_directory_counts_direct
    description: "Scancode license counts per directory (direct scope - files in directory only)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_license_count
        tests:
          - not_null

  - name: rollup_scancode_directory_counts_recursive
    description: "Scancode license counts per directory (recursive scope - includes subtree)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_license_count
        tests:
          - not_null

  - name: rollup_scancode_directory_direct_distributions
    description: "Distribution statistics for scancode license metrics (direct scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - license_count
                  - avg_confidence
      - name: value_count
        tests:
          - not_null

  - name: rollup_scancode_directory_recursive_distributions
    description: "Distribution statistics for scancode license metrics (recursive scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - license_count
                  - avg_confidence
      - name: value_count
        tests:
          - not_null

  - name: rollup_dotcover_directory_counts_direct
    description: "Dotcover coverage counts per directory (direct scope - files in directory only)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_type_count
        tests:
          - not_null

  - name: rollup_dotcover_directory_counts_recursive
    description: "Dotcover coverage counts per directory (recursive scope - includes subtree)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: file_count
        tests:
          - not_null
      - name: total_type_count
        tests:
          - not_null

  - name: rollup_dotcover_directory_direct_distributions
    description: "Distribution statistics for dotcover coverage metrics (direct scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - statement_coverage_pct
                  - type_count
      - name: value_count
        tests:
          - not_null

  - name: rollup_dotcover_directory_recursive_distributions
    description: "Distribution statistics for dotcover coverage metrics (recursive scope)"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: directory_id
        tests:
          - not_null
      - name: directory_path
        tests:
          - not_null
      - name: metric
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - statement_coverage_pct
                  - type_count
      - name: value_count
        tests:
          - not_null

  - name: stg_symbol_coupling_metrics
    description: "Per-symbol coupling metrics: fan-in, fan-out, and instability"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: symbol_name
        tests:
          - not_null
      - name: fan_in
        tests:
          - not_null
      - name: fan_out
        tests:
          - not_null
      - name: total_coupling
        tests:
          - not_null
      - name: instability
        tests:
          - not_null

  - name: mart_blast_radius_symbol
    description: "Transitive caller analysis for change impact assessment"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: target_symbol
        tests:
          - not_null
      - name: blast_radius_symbols
        tests:
          - not_null
      - name: blast_radius_files
        tests:
          - not_null
      - name: max_depth
        tests:
          - not_null
      - name: blast_radius_risk
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - low
                  - medium
                  - high
                  - critical

  - name: mart_circular_dependencies
    description: "Circular dependency detection in import graph"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: start_file
        tests:
          - not_null
      - name: cycle_path
        tests:
          - not_null
      - name: cycle_length
        tests:
          - not_null
      - name: severity
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - low
                  - medium
                  - high
                  - critical

  - name: stg_lz_git_fame_authors
    description: "Per-author authorship metrics from git-fame analysis"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: author_name
        tests:
          - not_null
      - name: surviving_loc
        tests:
          - not_null
      - name: ownership_pct
        tests:
          - not_null
      - name: commit_count
        tests:
          - not_null
      - name: files_touched
        tests:
          - not_null

  - name: stg_lz_git_fame_summary
    description: "Repository-level authorship summary from git-fame analysis"
    columns:
      - name: run_pk
        tests:
          - not_null
          - unique
      - name: repo_id
        tests:
          - not_null
      - name: author_count
        tests:
          - not_null
      - name: total_loc
        tests:
          - not_null
      - name: hhi_index
        tests:
          - not_null
      - name: bus_factor
        tests:
          - not_null
      - name: top_author_pct
        tests:
          - not_null
      - name: top_two_pct
        tests:
          - not_null

  - name: mart_authorship_summary
    description: "Authorship summary combining git-fame metrics with unified code metrics for correlation analysis"
    columns:
      - name: run_pk
        tests:
          - not_null
          - unique
      - name: collection_run_id
        tests:
          - not_null
      - name: repo_id
        tests:
          - not_null
      - name: author_count
        tests:
          - not_null
      - name: hhi_index
        tests:
          - not_null
      - name: bus_factor
        tests:
          - not_null
      - name: concentration_risk
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - low
                  - medium
                  - high
      - name: bus_factor_risk
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - critical
                  - warning
                  - healthy
      - name: single_author_dominated
        tests:
          - not_null

  - name: mart_author_contributions
    description: "Author contributions ranked and tiered by contribution level with commitment metrics"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: author_name
        tests:
          - not_null
      - name: surviving_loc
        tests:
          - not_null
      - name: ownership_pct
        tests:
          - not_null
      - name: commit_count
        tests:
          - not_null
      - name: files_touched
        tests:
          - not_null
      - name: contribution_rank
        tests:
          - not_null
      - name: contribution_tier
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - top_10_pct
                  - top_25_pct
                  - top_50_pct
                  - bottom_50_pct

  - name: mart_authorship_risk
    description: "Authorship risk assessment with team health grades and recommended actions"
    columns:
      - name: run_pk
        tests:
          - not_null
          - unique
      - name: collection_run_id
        tests:
          - not_null
      - name: repo_id
        tests:
          - not_null
      - name: author_count
        tests:
          - not_null
      - name: hhi_index
        tests:
          - not_null
      - name: bus_factor
        tests:
          - not_null
      - name: concentration_level
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - highly_concentrated
                  - moderately_concentrated
                  - slightly_concentrated
                  - well_distributed
      - name: bus_factor_assessment
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - no_data
                  - critical
                  - at_risk
                  - moderate
                  - healthy
      - name: single_author_risk
        tests:
          - not_null
      - name: top_two_dominance
        tests:
          - not_null
      - name: team_health_grade
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - A
                  - B
                  - C
                  - D
                  - F
      - name: recommended_action
        tests:
          - not_null

  - name: mart_project_dependency_cycles
    description: "Circular dependency detection in .NET project reference graph"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: start_project
        tests:
          - not_null
      - name: cycle_path
        tests:
          - not_null
      - name: cycle_length
        tests:
          - not_null
      - name: severity
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - low
                  - medium
                  - high
                  - critical

  - name: mart_project_blast_radius
    description: "Impact analysis for .NET project changes"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: target_project_path
        tests:
          - not_null
      - name: blast_radius_projects
        tests:
          - not_null
      - name: blast_radius_depth
        tests:
          - not_null
      - name: total_paths
        tests:
          - not_null
      - name: blast_radius_risk
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - low
                  - medium
                  - high
                  - critical

  - name: mart_package_version_conflicts
    description: "NuGet package version conflict detection"
    columns:
      - name: run_pk
        tests:
          - not_null
      - name: package_name
        tests:
          - not_null
      - name: version_count
        tests:
          - not_null
      - name: versions_list
        tests:
          - not_null
      - name: projects_affected
        tests:
          - not_null
      - name: conflict_severity
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - low
                  - medium
                  - high
                  - critical

  - name: mart_dependency_health_summary
    description: "Repository-level .NET dependency health metrics"
    columns:
      - name: run_pk
        tests:
          - not_null
          - unique
      - name: total_projects
        tests:
          - not_null
      - name: total_project_refs
        tests:
          - not_null
      - name: total_package_refs
        tests:
          - not_null
      - name: unique_packages
        tests:
          - not_null
      - name: circular_dependency_count
        tests:
          - not_null
      - name: version_conflict_count
        tests:
          - not_null
      - name: health_grade
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - A
                  - B
                  - C
                  - D
                  - F
      - name: recommendations
        tests:
          - not_null