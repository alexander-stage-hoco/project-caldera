{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Architecture Review Result",
  "description": "Output schema for the Project Caldera architecture reviewer sub-agent.",
  "type": "object",
  "required": ["review_id", "timestamp", "target", "review_type", "dimensions", "summary"],
  "properties": {
    "review_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this review run."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 timestamp of when the review was performed."
    },
    "target": {
      "type": "string",
      "description": "Tool name (e.g., 'lizard') or 'cross-tool' for cross-tool reviews."
    },
    "review_type": {
      "type": "string",
      "enum": ["tool_implementation", "cross_tool", "blueprint_alignment"],
      "description": "Type of architecture review performed."
    },
    "dimensions": {
      "type": "array",
      "description": "Results for each review dimension.",
      "items": {
        "type": "object",
        "required": ["dimension", "weight", "status", "score", "findings"],
        "properties": {
          "dimension": {
            "type": "string",
            "description": "Dimension identifier (e.g., 'entity_persistence_pattern')."
          },
          "weight": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Weight of this dimension in overall score."
          },
          "status": {
            "type": "string",
            "enum": ["pass", "warn", "fail"],
            "description": "Dimension-level status derived from findings."
          },
          "score": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5,
            "description": "Dimension score (1=failing, 5=excellent)."
          },
          "findings": {
            "type": "array",
            "description": "Individual findings for this dimension.",
            "items": {
              "type": "object",
              "required": ["severity", "rule_id", "message"],
              "properties": {
                "severity": {
                  "type": "string",
                  "enum": ["error", "warning", "info"],
                  "description": "Finding severity level."
                },
                "category": {
                  "type": "string",
                  "enum": [
                    "pattern_violation",
                    "missing_requirement",
                    "inconsistency",
                    "anti_pattern",
                    "placeholder_content",
                    "naming_drift"
                  ],
                  "description": "Category of the finding."
                },
                "file": {
                  "type": "string",
                  "description": "File path relative to project root where the finding was identified."
                },
                "line": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "Line number in the file (if applicable)."
                },
                "rule_id": {
                  "type": "string",
                  "description": "Rule identifier (e.g., 'ENTITY_FROZEN')."
                },
                "message": {
                  "type": "string",
                  "description": "Human-readable description of the finding."
                },
                "evidence": {
                  "type": "string",
                  "description": "Code snippet or content that triggered the finding."
                },
                "recommendation": {
                  "type": "string",
                  "description": "Suggested fix for the finding."
                }
              }
            }
          }
        }
      }
    },
    "summary": {
      "type": "object",
      "required": ["total_findings", "by_severity", "overall_status", "overall_score", "dimensions_reviewed"],
      "properties": {
        "total_findings": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of findings across all dimensions."
        },
        "by_severity": {
          "type": "object",
          "required": ["error", "warning", "info"],
          "properties": {
            "error": { "type": "integer", "minimum": 0 },
            "warning": { "type": "integer", "minimum": 0 },
            "info": { "type": "integer", "minimum": 0 }
          }
        },
        "overall_status": {
          "type": "string",
          "enum": ["STRONG_PASS", "PASS", "WEAK_PASS", "NEEDS_WORK"],
          "description": "Advisory status derived from weighted overall score."
        },
        "overall_score": {
          "type": "number",
          "minimum": 1,
          "maximum": 5,
          "description": "Weighted average score across all reviewed dimensions."
        },
        "dimensions_reviewed": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of dimensions included in this review."
        }
      }
    }
  }
}
